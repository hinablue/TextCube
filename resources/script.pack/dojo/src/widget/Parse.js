/*
	Copyright (c) 2004-2006, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/community/licensing.shtml
*/dojo.provide("dojo.widget.Parse"),dojo.require("dojo.widget.Manager"),dojo.require("dojo.dom"),dojo.widget.Parse=function(a){this.propertySetsList=[],this.fragment=a,this.createComponents=function(a,b){var c=[],d=!1;try{if(a&&a.tagName&&a!=a.nodeRef){var e=dojo.widget.tags,f=String(a.tagName).split(";");for(var g=0;g<f.length;g++){var h=f[g].replace(/^\s+|\s+$/g,"").toLowerCase();a.tagName=h;var i;e[h]?(d=!0,i=e[h](a,this,b,a.index),c.push(i)):(h.indexOf(":")==-1&&(h="dojo:"+h),i=dojo.widget.buildWidgetFromParseTree(h,a,this,b,a.index),i&&(d=!0,c.push(i)))}}}catch(j){dojo.debug("dojo.widget.Parse: error:",j)}d||(c=c.concat(this.createSubComponents(a,b)));return c},this.createSubComponents=function(a,b){var c,d=[];for(var e in a)c=a[e],c&&typeof c=="object"&&c!=a.nodeRef&&c!=a.tagName&&!dojo.dom.isNode(c)&&(d=d.concat(this.createComponents(c,b)));return d},this.parsePropertySets=function(a){return[]},this.parseProperties=function(a){var b={};for(var c in a)if(a[c]!=a.tagName&&a[c]!=a.nodeRef){var d=a[c];if(!d.tagName||!dojo.widget.tags[d.tagName.toLowerCase()])if(d[0]&&d[0].value!=""&&d[0].value!=null)try{if(c.toLowerCase()=="dataprovider"){var e=this;this.getDataProvider(e,d[0].value),b.dataProvider=this.dataProvider}b[c]=d[0].value;var f=this.parseProperties(d);for(var g in f)b[g]=f[g]}catch(h){dojo.debug(h)}switch(c.toLowerCase()){case"checked":case"disabled":typeof b[c]!="boolean"&&(b[c]=!0)}}return b},this.getDataProvider=function(a,b){dojo.io.bind({url:b,load:function(b,c){b=="load"&&(a.dataProvider=c)},mimetype:"text/javascript",sync:!0})},this.getPropertySetById=function(a){for(var b=0;b<this.propertySetsList.length;b++)if(a==this.propertySetsList[b].id[0].value)return this.propertySetsList[b];return""},this.getPropertySetsByType=function(a){var b=[];for(var c=0;c<this.propertySetsList.length;c++){var d=this.propertySetsList[c],e=d.componentClass||d.componentType||null,f=this.propertySetsList[c].id[0].value;e&&f==e[0].value&&b.push(d)}return b},this.getPropertySets=function(a){var b="dojo:propertyproviderlist",c=[],d=a.tagName;if(a[b]){var e=a[b].value.split(" ");for(var f in e)if(f.indexOf("..")==-1&&f.indexOf("://")==-1){var g=this.getPropertySetById(f);g!=""&&c.push(g)}}return this.getPropertySetsByType(d).concat(c)},this.createComponentFromScript=function(a,b,c,d){c.fastMixIn=!0;var e=(d||"dojo")+":"+b.toLowerCase();if(dojo.widget.tags[e])return[dojo.widget.tags[e](c,this,null,null,c)];return[dojo.widget.buildWidgetFromParseTree(e,c,this,null,null,c)]}},dojo.widget._parser_collection={dojo:new dojo.widget.Parse},dojo.widget.getParser=function(a){a||(a="dojo"),this._parser_collection[a]||(this._parser_collection[a]=new dojo.widget.Parse);return this._parser_collection[a]},dojo.widget.createWidget=function(a,b,c,d){function m(a,b,c,d){c[j]={dojotype:[{value:i}],nodeRef:a,fastMixIn:!0},c.ns=d;return dojo.widget.getParser().createComponentFromScript(a,b,c,d)}var e=!1,f=typeof a=="string";if(f){var g=a.indexOf(":"),h=g>-1?a.substring(0,g):"dojo";g>-1&&(a=a.substring(g+1));var i=a.toLowerCase(),j=h+":"+i;e=dojo.byId(a)&&!dojo.widget.tags[j]}if(arguments.length==1&&(e||!f)){var k=new dojo.xml.Parse,l=e?dojo.byId(a):a;return dojo.widget.getParser().createComponents(k.parseElement(l,null,!0))[0]}b=b||{};var n=!1,l=null,o=dojo.render.html.capable;o&&(l=document.createElement("span")),c?d?dojo.dom.insertAtPosition(l,c,d):l=c:(n=!0,c=l,o&&dojo.body().appendChild(c));var p=m(l,a.toLowerCase(),b,h);if(!p||!p[0]||typeof p[0].widgetType=="undefined")throw new Error('createWidget: Creation of "'+a+'" widget failed.');try{n&&p[0].domNode.parentNode&&p[0].domNode.parentNode.removeChild(p[0].domNode)}catch(q){dojo.debug(q)}return p[0]}