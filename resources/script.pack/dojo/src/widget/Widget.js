/*
	Copyright (c) 2004-2006, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/community/licensing.shtml
*/dojo.provide("dojo.widget.Widget"),dojo.require("dojo.lang.func"),dojo.require("dojo.lang.array"),dojo.require("dojo.lang.extras"),dojo.require("dojo.lang.declare"),dojo.require("dojo.ns"),dojo.require("dojo.widget.Manager"),dojo.require("dojo.event.*"),dojo.require("dojo.a11y"),dojo.declare("dojo.widget.Widget",null,function(){this.children=[],this.extraArgs={}},{parent:null,isTopLevel:!1,disabled:!1,isContainer:!1,widgetId:"",widgetType:"Widget",ns:"dojo",getNamespacedType:function(){return(this.ns?this.ns+":"+this.widgetType:this.widgetType).toLowerCase()},toString:function(){return"[Widget "+this.getNamespacedType()+", "+(this.widgetId||"NO ID")+"]"},repr:function(){return this.toString()},enable:function(){this.disabled=!1},disable:function(){this.disabled=!0},onResized:function(){this.notifyChildrenOfResize()},notifyChildrenOfResize:function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];b.onResized&&b.onResized()}},create:function(a,b,c,d){d&&(this.ns=d),this.satisfyPropertySets(a,b,c),this.mixInProperties(a,b,c),this.postMixInProperties(a,b,c),dojo.widget.manager.add(this),this.buildRendering(a,b,c),this.initialize(a,b,c),this.postInitialize(a,b,c),this.postCreate(a,b,c);return this},destroy:function(a){this.parent&&this.parent.removeChild(this),this.destroyChildren(),this.uninitialize(),this.destroyRendering(a),dojo.widget.manager.removeById(this.widgetId)},destroyChildren:function(){var a,b=0;while(this.children.length>b){a=this.children[b];if(a instanceof dojo.widget.Widget){this.removeChild(a),a.destroy();continue}b++}},getChildrenOfType:function(a,b){var c=[],d=dojo.lang.isFunction(a);d||(a=a.toLowerCase());for(var e=0;e<this.children.length;e++)d?this.children[e]instanceof a&&c.push(this.children[e]):this.children[e].widgetType.toLowerCase()==a&&c.push(this.children[e]),b&&(c=c.concat(this.children[e].getChildrenOfType(a,b)));return c},getDescendants:function(){var a=[],b=[this],c;while(c=b.pop())a.push(c),c.children&&dojo.lang.forEach(c.children,function(a){b.push(a)});return a},isFirstChild:function(){return this===this.parent.children[0]},isLastChild:function(){return this===this.parent.children[this.parent.children.length-1]},satisfyPropertySets:function(a){return a},mixInProperties:function(a,b){if(a.fastMixIn||b.fastMixIn)for(var c in a)this[c]=a[c];else{var d,e=dojo.widget.lcArgsCache[this.widgetType];if(e==null){e={};for(var f in this)e[(new String(f)).toLowerCase()]=f;dojo.widget.lcArgsCache[this.widgetType]=e}var g={};for(var c in a){if(!this[c]){var f=e[(new String(c)).toLowerCase()];f&&(a[f]=a[c],c=f)}if(g[c])continue;g[c]=!0;if(typeof this[c]!=typeof d)if(typeof a[c]!="string")this[c]=a[c];else if(dojo.lang.isString(this[c]))this[c]=a[c];else if(dojo.lang.isNumber(this[c]))this[c]=new Number(a[c]);else if(dojo.lang.isBoolean(this[c]))this[c]=a[c].toLowerCase()=="false"?!1:!0;else if(dojo.lang.isFunction(this[c]))if(a[c].search(/[^\w\.]+/i)==-1)this[c]=dojo.evalObjPath(a[c],!1);else{var h=dojo.lang.nameAnonFunc(new Function(a[c]),this);dojo.event.kwConnect({srcObj:this,srcFunc:c,adviceObj:this,adviceFunc:h})}else if(dojo.lang.isArray(this[c]))this[c]=a[c].split(";");else if(this[c]instanceof Date)this[c]=new Date(Number(a[c]));else if(typeof this[c]=="object")if(this[c]instanceof dojo.uri.Uri)this[c]=dojo.uri.dojoUri(a[c]);else{var i=a[c].split(";");for(var f=0;f<i.length;f++){var j=i[f].indexOf(":");j!=-1&&i[f].length>j&&(this[c][i[f].substr(0,j).replace(/^\s+|\s+$/g,"")]=i[f].substr(j+1))}}else this[c]=a[c];else this.extraArgs[c.toLowerCase()]=a[c]}}},postMixInProperties:function(a,b,c){},initialize:function(a,b,c){return!1},postInitialize:function(a,b,c){return!1},postCreate:function(a,b,c){return!1},uninitialize:function(){return!1},buildRendering:function(a,b,c){dojo.unimplemented("dojo.widget.Widget.buildRendering, on "+this.toString()+", ");return!1},destroyRendering:function(){dojo.unimplemented("dojo.widget.Widget.destroyRendering");return!1},addedTo:function(a){},addChild:function(a){dojo.unimplemented("dojo.widget.Widget.addChild");return!1},removeChild:function(a){for(var b=0;b<this.children.length;b++)if(this.children[b]===a){this.children.splice(b,1),a.parent=null;break}return a},getPreviousSibling:function(){var a=this.getParentIndex();if(a<=0)return null;return this.parent.children[a-1]},getSiblings:function(){return this.parent.children},getParentIndex:function(){return dojo.lang.indexOf(this.parent.children,this,!0)},getNextSibling:function(){var a=this.getParentIndex();if(a==this.parent.children.length-1)return null;if(a<0)return null;return this.parent.children[a+1]}}),dojo.widget.lcArgsCache={},dojo.widget.tags={},dojo.widget.tags.addParseTreeHandler=function(a){dojo.deprecated("addParseTreeHandler",". ParseTreeHandlers are now reserved for components. Any unfiltered DojoML tag without a ParseTreeHandler is assumed to be a widget","0.5")},dojo.widget.tags["dojo:propertyset"]=function(a,b,c){var d=b.parseProperties(a["dojo:propertyset"])},dojo.widget.tags["dojo:connect"]=function(a,b,c){var d=b.parseProperties(a["dojo:connect"])},dojo.widget.buildWidgetFromParseTree=function(a,b,c,d,e,f){dojo.a11y.setAccessibleMode();var g=a.split(":");g=g.length==2?g[1]:a;var h=f||c.parseProperties(b[b.ns+":"+g]),i=dojo.widget.manager.getImplementation(g,null,null,b.ns);if(!i)throw new Error('cannot find "'+a+'" widget');if(!i.create)throw new Error('"'+a+'" widget object has no "create" method and does not appear to implement *Widget');h.dojoinsertionindex=e;var j=i.create(h,b,d,b.ns);return j},dojo.widget.defineWidget=function(a,b,c,d,e){if(dojo.lang.isString(arguments[3]))dojo.widget._defineWidget(arguments[0],arguments[3],arguments[1],arguments[4],arguments[2]);else{var f=[arguments[0]],g=3;dojo.lang.isString(arguments[1])?f.push(arguments[1],arguments[2]):(f.push("",arguments[1]),g=2),dojo.lang.isFunction(arguments[g])?f.push(arguments[g],arguments[g+1]):f.push(null,arguments[g]),dojo.widget._defineWidget.apply(this,f)}},dojo.widget.defineWidget.renderers="html|svg|vml",dojo.widget._defineWidget=function(a,b,c,d,e){var f=a.split("."),g=f.pop(),h="\\.("+(b?b+"|":"")+dojo.widget.defineWidget.renderers+")\\.",i=a.search(new RegExp(h));f=i<0?f.join("."):a.substr(0,i),dojo.widget.manager.registerWidgetPackage(f);var j=f.indexOf("."),k=j>-1?f.substring(0,j):f;e=e||{},e.widgetType=g,!d&&e.classConstructor&&(d=e.classConstructor,delete e.classConstructor),dojo.declare(a,c,d,e)}