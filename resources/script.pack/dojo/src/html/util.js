/*
	Copyright (c) 2004-2006, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/community/licensing.shtml
*/dojo.provide("dojo.html.util"),dojo.require("dojo.html.layout"),dojo.html.getElementWindow=function(a){return dojo.html.getDocumentWindow(a.ownerDocument)},dojo.html.getDocumentWindow=function(a){if(dojo.render.html.safari&&!a._parentWindow){var b=function(a){a.document._parentWindow=a;for(var c=0;c<a.frames.length;c++)b(a.frames[c])};b(window.top)}if(dojo.render.html.ie&&window!==document.parentWindow&&!a._parentWindow){a.parentWindow.execScript("document._parentWindow = window;","Javascript");var c=a._parentWindow;a._parentWindow=null;return c}return a._parentWindow||a.parentWindow||a.defaultView},dojo.html.gravity=function(node,e){node=dojo.byId(node);var mouse=dojo.html.getCursorPosition(e);with(dojo.html)var absolute=getAbsolutePosition(node,!0),bb=getBorderBox(node),nodecenterx=absolute.x+bb.width/2,nodecentery=absolute.y+bb.height/2;with(dojo.html.gravity)return(mouse.x<nodecenterx?WEST:EAST)|(mouse.y<nodecentery?NORTH:SOUTH)},dojo.html.gravity.NORTH=1,dojo.html.gravity.SOUTH=2,dojo.html.gravity.EAST=4,dojo.html.gravity.WEST=8,dojo.html.overElement=function(a,b){a=dojo.byId(a);var c=dojo.html.getCursorPosition(b),d=dojo.html.getBorderBox(a),e=dojo.html.getAbsolutePosition(a,!0,dojo.html.boxSizing.BORDER_BOX),f=e.y,g=f+d.height,h=e.x,i=h+d.width;return c.x>=h&&c.x<=i&&c.y>=f&&c.y<=g},dojo.html.renderedTextContent=function(a){a=dojo.byId(a);var b="";if(a==null)return b;for(var c=0;c<a.childNodes.length;c++)switch(a.childNodes[c].nodeType){case 1:case 5:var d="unknown";try{d=dojo.html.getStyle(a.childNodes[c],"display")}catch(e){}switch(d){case"block":case"list-item":case"run-in":case"table":case"table-row-group":case"table-header-group":case"table-footer-group":case"table-row":case"table-column-group":case"table-column":case"table-cell":case"table-caption":b+="\n",b+=dojo.html.renderedTextContent(a.childNodes[c]),b+="\n";break;case"none":break;default:a.childNodes[c].tagName&&a.childNodes[c].tagName.toLowerCase()=="br"?b+="\n":b+=dojo.html.renderedTextContent(a.childNodes[c])}break;case 3:case 2:case 4:var f=a.childNodes[c].nodeValue,g="unknown";try{g=dojo.html.getStyle(a,"text-transform")}catch(e){}switch(g){case"capitalize":var h=f.split(" ");for(var c=0;c<h.length;c++)h[c]=h[c].charAt(0).toUpperCase()+h[c].substring(1);f=h.join(" ");break;case"uppercase":f=f.toUpperCase();break;case"lowercase":f=f.toLowerCase();break;default:}switch(g){case"nowrap":break;case"pre-wrap":break;case"pre-line":break;case"pre":break;default:f=f.replace(/\s+/," "),/\s$/.test(b)&&f.replace(/^\s/,"")}b+=f;break;default:}return b},dojo.html.createNodesFromText=function(a,b){b&&(a=a.replace(/^\s+|\s+$/g,""));var c=dojo.doc().createElement("div");c.style.visibility="hidden",dojo.body().appendChild(c);var d="none";/^<t[dh][\s\r\n>]/i.test(a.replace(/^\s+/))?(a="<table><tbody><tr>"+a+"</tr></tbody></table>",d="cell"):/^<tr[\s\r\n>]/i.test(a.replace(/^\s+/))?(a="<table><tbody>"+a+"</tbody></table>",d="row"):/^<(thead|tbody|tfoot)[\s\r\n>]/i.test(a.replace(/^\s+/))&&(a="<table>"+a+"</table>",d="section"),c.innerHTML=a,c.normalize&&c.normalize();var e=null;switch(d){case"cell":e=c.getElementsByTagName("tr")[0];break;case"row":e=c.getElementsByTagName("tbody")[0];break;case"section":e=c.getElementsByTagName("table")[0];break;default:e=c}var f=[];for(var g=0;g<e.childNodes.length;g++)f.push(e.childNodes[g].cloneNode(!0));c.style.display="none",dojo.html.destroyNode(c);return f},dojo.html.placeOnScreen=function(a,b,c,d,e,f,g){if(b instanceof Array||typeof b=="array")g=f,f=e,e=d,d=c,c=b[1],b=b[0];if(f instanceof String||typeof f=="string")f=f.split(",");isNaN(d)?d instanceof Array||typeof d=="array"||(d=[0,0]):d=[Number(d),Number(d)];var h=dojo.html.getScroll().offset,i=dojo.html.getViewport();a=dojo.byId(a);var j=a.style.display;a.style.display="";var k=dojo.html.getBorderBox(a),l=k.width,m=k.height;a.style.display=j,f instanceof Array||typeof f=="array"||(f=["TL"]);var n,o,p=Infinity,q;for(var r=0;r<f.length;++r){var s=f[r],t=!0,u=b-(s.charAt(1)=="L"?0:l)+d[0]*(s.charAt(1)=="L"?1:-1),v=c-(s.charAt(0)=="T"?0:m)+d[1]*(s.charAt(0)=="T"?1:-1);e&&(u-=h.x,v-=h.y),u<0&&(u=0,t=!1),v<0&&(v=0,t=!1);var w=u+l;w>i.width?(w=i.width-l,t=!1):w=u,w=Math.max(d[0],w)+h.x;var x=v+m;x>i.height?(x=i.height-m,t=!1):x=v,x=Math.max(d[1],x)+h.y;if(t){n=w,o=x,p=0,q=s;break}var y=Math.pow(w-u-h.x,2)+Math.pow(x-v-h.y,2);p>y&&(p=y,n=w,o=x,q=s)}g||(a.style.left=n+"px",a.style.top=o+"px");return{left:n,top:o,x:n,y:o,dist:p,corner:q}},dojo.html.placeOnScreenPoint=function(a,b,c,d,e){dojo.deprecated("dojo.html.placeOnScreenPoint","use dojo.html.placeOnScreen() instead","0.5");return dojo.html.placeOnScreen(a,b,c,d,e,["TL","TR","BL","BR"])},dojo.html.placeOnScreenAroundElement=function(a,b,c,d,e,f){var g,h=Infinity;b=dojo.byId(b);var i=b.style.display;b.style.display="";var j=dojo.html.getElementBox(b,d),k=j.width,l=j.height,m=dojo.html.getAbsolutePosition(b,!0,d);b.style.display=i;for(var n in e){var o,p,q,r=e[n];p=m.x+(n.charAt(1)=="L"?0:k),q=m.y+(n.charAt(0)=="T"?0:l),o=dojo.html.placeOnScreen(a,p,q,c,!0,r,!0);if(o.dist==0){g=o;break}h>o.dist&&(h=o.dist,g=o)}f||(a.style.left=g.left+"px",a.style.top=g.top+"px");return g},dojo.html.scrollIntoView=function(a){if(!!a)if(dojo.render.html.ie)dojo.html.getBorderBox(a.parentNode).height<=a.parentNode.scrollHeight&&a.scrollIntoView(!1);else if(dojo.render.html.mozilla)a.scrollIntoView(!1);else{var b=a.parentNode,c=b.scrollTop+dojo.html.getBorderBox(b).height,d=a.offsetTop+dojo.html.getMarginBox(a).height;c<d?b.scrollTop+=d-c:b.scrollTop>a.offsetTop&&(b.scrollTop-=b.scrollTop-a.offsetTop)}}