/*
	Copyright (c) 2004-2006, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/community/licensing.shtml
*/dojo.require("dojo.html.common"),dojo.provide("dojo.html.selection"),dojo.require("dojo.dom"),dojo.require("dojo.lang.common"),dojo.html.selectionType={NONE:0,TEXT:1,CONTROL:2},dojo.html.clearSelection=function(){var a=dojo.global(),b=dojo.doc();try{a.getSelection?dojo.render.html.safari?a.getSelection().collapse():a.getSelection().removeAllRanges():b.selection&&(b.selection.empty?b.selection.empty():b.selection.clear&&b.selection.clear());return!0}catch(c){dojo.debug(c);return!1}},dojo.html.disableSelection=function(a){a=dojo.byId(a)||dojo.body();var b=dojo.render.html;if(b.mozilla)a.style.MozUserSelect="none";else if(b.safari)a.style.KhtmlUserSelect="none";else if(b.ie)a.unselectable="on";else return!1;return!0},dojo.html.enableSelection=function(a){a=dojo.byId(a)||dojo.body();var b=dojo.render.html;if(b.mozilla)a.style.MozUserSelect="";else if(b.safari)a.style.KhtmlUserSelect="";else if(b.ie)a.unselectable="off";else return!1;return!0},dojo.html.selectElement=function(a){dojo.deprecated("dojo.html.selectElement","replaced by dojo.html.selection.selectElementChildren",.5)},dojo.html.selectInputText=function(a){var b=dojo.global(),c=dojo.doc();a=dojo.byId(a);if(c.selection&&dojo.body().createTextRange){var d=a.createTextRange();d.moveStart("character",0),d.moveEnd("character",a.value.length),d.select()}else if(b.getSelection){var e=b.getSelection();a.setSelectionRange(0,a.value.length)}a.focus()},dojo.html.isSelectionCollapsed=function(){dojo.deprecated("dojo.html.isSelectionCollapsed","replaced by dojo.html.selection.isCollapsed",.5);return dojo.html.selection.isCollapsed()},dojo.lang.mixin(dojo.html.selection,{getType:function(){if(dojo.doc().selection)return dojo.html.selectionType[dojo.doc().selection.type.toUpperCase()];var a=dojo.html.selectionType.TEXT,b;try{b=dojo.global().getSelection()}catch(c){}if(b&&b.rangeCount==1){var d=b.getRangeAt(0);d.startContainer==d.endContainer&&d.endOffset-d.startOffset==1&&d.startContainer.nodeType!=dojo.dom.TEXT_NODE&&(a=dojo.html.selectionType.CONTROL)}return a},isCollapsed:function(){var a=dojo.global(),b=dojo.doc();if(b.selection)return b.selection.createRange().text=="";if(a.getSelection){var c=a.getSelection();return dojo.lang.isString(c)?c=="":c.isCollapsed||c.toString()==""}},getSelectedElement:function(){if(dojo.html.selection.getType()==dojo.html.selectionType.CONTROL){if(!dojo.doc().selection){var b=dojo.global().getSelection();return b.anchorNode.childNodes[b.anchorOffset]}var a=dojo.doc().selection.createRange();if(a&&a.item)return dojo.doc().selection.createRange().item(0)}},getParentElement:function(){if(dojo.html.selection.getType()==dojo.html.selectionType.CONTROL){var a=dojo.html.selection.getSelectedElement();if(a)return a.parentNode}else{if(dojo.doc().selection)return dojo.doc().selection.createRange().parentElement();var b=dojo.global().getSelection();if(b){var c=b.anchorNode;while(c&&c.nodeType!=dojo.dom.ELEMENT_NODE)c=c.parentNode;return c}}},getSelectedText:function(){if(dojo.doc().selection){if(dojo.html.selection.getType()==dojo.html.selectionType.CONTROL)return null;return dojo.doc().selection.createRange().text}var a=dojo.global().getSelection();if(a)return a.toString()},getSelectedHtml:function(){if(dojo.doc().selection){if(dojo.html.selection.getType()==dojo.html.selectionType.CONTROL)return null;return dojo.doc().selection.createRange().htmlText}var a=dojo.global().getSelection();if(a&&a.rangeCount){var b=a.getRangeAt(0).cloneContents(),c=document.createElement("div");c.appendChild(b);return c.innerHTML}return null},hasAncestorElement:function(a){return dojo.html.selection.getAncestorElement.apply(this,arguments)!=null},getAncestorElement:function(a){var b=dojo.html.selection.getSelectedElement()||dojo.html.selection.getParentElement();while(b){if(dojo.html.selection.isTag(b,arguments).length>0)return b;b=b.parentNode}return null},isTag:function(a,b){if(a&&a.tagName)for(var c=0;c<b.length;c++)if(a.tagName.toLowerCase()==String(b[c]).toLowerCase())return String(b[c]).toLowerCase();return""},selectElement:function(a){var b=dojo.global(),c=dojo.doc();a=dojo.byId(a);if(c.selection&&dojo.body().createTextRange)try{var d=dojo.body().createControlRange();d.addElement(a),d.select()}catch(e){dojo.html.selection.selectElementChildren(a)}else if(b.getSelection){var f=b.getSelection();if(f.removeAllRanges){var d=c.createRange();d.selectNode(a),f.removeAllRanges(),f.addRange(d)}}},selectElementChildren:function(a){var b=dojo.global(),c=dojo.doc();a=dojo.byId(a);if(c.selection&&dojo.body().createTextRange){var d=dojo.body().createTextRange();d.moveToElementText(a),d.select()}else if(b.getSelection){var e=b.getSelection();e.setBaseAndExtent?e.setBaseAndExtent(a,0,a,a.innerText.length-1):e.selectAllChildren&&e.selectAllChildren(a)}},getBookmark:function(){var a,b=dojo.doc();if(b.selection){var c=b.selection.createRange();a=c.getBookmark()}else{var d;try{d=dojo.global().getSelection()}catch(e){}if(d){var c=d.getRangeAt(0);a=c.cloneRange()}else dojo.debug("No idea how to store the current selection for this browser!")}return a},moveToBookmark:function(a){var b=dojo.doc();if(b.selection){var c=b.selection.createRange();c.moveToBookmark(a),c.select()}else{var d;try{d=dojo.global().getSelection()}catch(e){}d&&d.removeAllRanges?(d.removeAllRanges(),d.addRange(a)):dojo.debug("No idea how to restore selection for this browser!")}},collapse:function(a){if(dojo.global().getSelection){var b=dojo.global().getSelection();b.removeAllRanges?a?b.collapseToStart():b.collapseToEnd():dojo.global().getSelection().collapse(a)}else if(dojo.doc().selection){var c=dojo.doc().selection.createRange();c.collapse(a),c.select()}},remove:function(){if(dojo.doc().selection){var a=dojo.doc().selection;a.type.toUpperCase()!="NONE"&&a.clear();return a}var a=dojo.global().getSelection();for(var b=0;b<a.rangeCount;b++)a.getRangeAt(b).deleteContents();return a}})