/// Copyright (c) 2004-2010, Needlworks  / Tatter Network Foundation
/// All rights reserved. Licensed under the GPL.
/// See the GNU General Public License for more details. (/documents/LICENSE, /documents/COPYRIGHT)
// 입력창을 10ms마다 체크하면서 값이 변했으면 request를 보낸다.
// 파이어폭스에서는 한글을 입력할때 keydown 이벤트가 발생하지 않기 때문에
// 값이 변하는지 계속 보고있어야 한다.
function debug(a){try{document.getElementById("debug").innerHTML=++x+")"+a+"<br />"+document.getElementById("debug").innerHTML}catch(b){}}function getOffsetLeft(a){return a?a.offsetLeft+getOffsetLeft(a.offsetParent):0}function getOffsetTop(a){return a?a.offsetTop+getOffsetTop(a.offsetParent):0}function Tag(a,b,c){this.name="Eolin Tag Object",this.copyright="Tatter & Company",this.allowEolinSuggestion=typeof c=="undefined"?!1:!c,this.isSettingValue=!1,this.instance=this,this.cursor=0,this.isTyping=!1,this.isSuggestionShown=!1,this.typingText="",this.inputClassName="",this.language="ko",typeof b!="undefined"&&(this.language=b),this.container=a,this.container.instance=this,this.suggestion=document.createElement("ul"),this.suggestion.instance=this,this.suggestion.selectedIndex=0,this.suggestion.className="eolinSuggest",this.suggestion.style.margin="0px",this.suggestion.style.padding="0px",this.suggestion.style.listStyleType="none",this.suggestion.style.position="absolute",this.suggestion.style.display="none",this.suggestion.style.zIndex="999",setInterval("eolinTagFunction_WatchInputBox('"+this.container.id+"')",10),this.inputOnLast=this.createSuggestInput(),this.inputTemporary=null,this.tagList=document.createElement("ul"),this.tagList.instance=this;var d=document.createElement("li");d.className="lastChild",d.appendChild(this.inputOnLast),this.tagList.appendChild(d),this.container.appendChild(this.tagList)}function eolinTagFunction_showSuggestion(){try{var a=document.getElementById(arguments[0]).instance}catch(b){return}if(a.cursor==arguments[1]&&!!a.isTyping){var c=a.getInput();if(c.value.trim()==""){a.hideSuggestion();return}a.suggestion.style.left=getOffsetLeft(c)+"px",a.suggestion.style.top=getOffsetTop(c)+c.offsetHeight+"px";var d=new StringBuffer;if(arguments[2]==0)for(var e=3;e<arguments.length;e++)arguments[e]=arguments[e].replaceAll("&quot;",'"'),STD.isSafari&&(arguments[e]=decodeURIComponent(arguments[e])),d.append('<li onmouseover="this.className=\'hover\'" onmouseout="this.className=\'\'" onmousedown="this.parentNode.instance.suggestionMouseClick(this)"><strong>'),d.append(arguments[e].substring(0,c.value.length).htmlspecialchars().replace("&amp;","&")),d.append("</strong>"),d.append(arguments[e].substring(c.value.length).htmlspecialchars().replace("&amp;","&")),d.append("</li>");else STD.isSafari&&(arguments[3]=decodeURIComponent(arguments[3])),d.append('<li class="disabled">'),d.append("<strong>"),d.append(c.value.htmlspecialchars()),d.append("</strong> - "+arguments[3]+"</li>");a.suggestion.innerHTML=d.toString(),a.suggestion.style.display="block",a.isSuggestionShown=!0;try{document.body.removeChild(a.suggestion)}catch(b){}document.body.appendChild(a.suggestion)}}function eolinTagFunction_showLocalSuggestionWithoutQuery(a,b,c){return eolinTagFunction_showLocalSuggestion(a,b,'name like "'+c.replace('"','\\"')+'%"')}function eolinTagFunction_showLocalSuggestion(a,b,c){try{var d=document.getElementById(a).instance}catch(e){return}if(d.cursor==b&&!!d.isTyping){var f=d.getInput(),g=createHttp();g&&(g.open("GET",blogURL+"/suggest/?id="+a+"&cursor="+b+"&filter="+(STD.isSafari?c:encodeURIComponent(c)),!0),g.onreadystatechange=function(){if(g.readyState==4)try{var a=g.responseXML,b=a.getElementsByTagName("response")[0],c=b.getAttribute("id"),d=b.getAttribute("cursor"),e=document.getElementById(c).instance;if(e.cursor==d){var h=[],i=b.getElementsByTagName("tag");if(!e.allowEolinSuggestion&&i.length==0){e.hideSuggestion();return}for(var j=0;j<i.length;j++)h[h.length]=i[j].lastChild.nodeValue;for(var j=0;j<h.length;j++)for(var k=0;k<e.suggestion.childNodes.length;k++)if(h[j]==e.suggestion.childNodes[k].innerHTML.replace(new RegExp("</?strong>","gi"),"")){e.suggestion.removeChild(e.suggestion.childNodes[k]);break}var l=new StringBuffer;for(var j=0;j<h.length;j++)l.append('<li onmouseover="this.className=\'hover\'" onmouseout="this.className=\'\'" onmousedown="this.parentNode.instance.suggestionMouseClick(this)" style="background-color: #ccb"><strong>'),l.append(h[j].substring(0,f.value.length).htmlspecialchars().replaceAll("&amp;","&")),l.append("</strong>"),l.append(h[j].substring(f.value.length).htmlspecialchars().replaceAll("&amp;","&")),l.append("</li>");e.allowEolinSuggestion&&l.append(e.suggestion.innerHTML),e.suggestion.innerHTML=l.toString();if(!e.allowEolinSuggestion||e.getInput().value.trim()==""){e.suggestion.style.left=getOffsetLeft(f)+"px",e.suggestion.style.top=getOffsetTop(f)+f.offsetHeight+"px",e.suggestion.style.display="block",e.isSuggestionShown=!0;try{document.body.removeChild(e.suggestion)}catch(m){}document.body.appendChild(e.suggestion)}while(e.suggestion.childNodes.length>10)e.suggestion.removeChild(e.suggestion.childNodes[e.suggestion.childNodes.length-1])}}catch(m){}},g.send(null),delete g)}}function eolinTagFunction_WatchInputBox(a){try{var b=document.getElementById(a).instance,c=b.getInput();if(c.value.charAt(c.value.length-1)==","){c.value.length==1?c.value="":b.setValue(c.value.substring(0,c.value.length-1));return}c.value!=b.typingText&&(b.typingText=c.value,b.requestSuggestion())}catch(d){}}Tag.prototype.isTemporaryEditing=function(){return this.inputTemporary!=null},Tag.prototype.setInputClassName=function(a){this.inputClassName=a,this.inputOnLast.className=a,this.inputTemporary&&(this.inputTemporary.className=a)},Tag.prototype.getInput=function(){return this.inputTemporary==null?this.inputOnLast:this.inputTemporary},Tag.prototype.adjustEventCompatibility=function(a){navigator.appName=="Microsoft Internet Explorer"&&(a=window.event,a.target=a.srcElement);return a},Tag.prototype.createSuggestInput=function(){var a=document.createElement("input");a.instance=this,a.className=this.inputClassName,a.setAttribute("autocomplete","off"),a.onblur=function(){var a=this.instance;a.isTyping=!1,a.hideSuggestion(),a.setValue(this.value)},a.onclick=this.requestSuggestion,a.onkeydown=function(a){var b=this.instance;b.isTyping=!0,a=b.adjustEventCompatibility(a);switch(a.keyCode){case 8:if(this.value=="")b.moveBack();else return a.keyCode;break;case 13:b.setValue(this.value);break;case 188:if(!a.shiftKey)b.setValue(this.value);else return a.keyCode;break;case 9:if(this.value.trim()=="")return a.keyCode;b.setValue(this.value);break;case 27:b.hideSuggestion();break;case 38:b.moveUp();break;case 40:b.moveDown();break;default:return a.keyCode}a.returnValue=!1,a.cancelBubble=!0;try{a.preventDefault()}catch(c){}return!1},a.onkeypress=function(a){return preventEnter(a)};return a},Tag.prototype.suggestionMouseClick=function(a){var b=this.getInput();this.hideSuggestion(),this.setValue(a.innerHTML.replace(new RegExp("</?strong>","gi"),"").replaceAll("&amp;","&"))},Tag.prototype.requestSuggestion=function(){var a=this.instance;a.isTyping=!0,a.cursor++;if(!a.allowEolinSuggestion||a.getInput().value.trim()=="")eolinTagFunction_showLocalSuggestionWithoutQuery(a.container.getAttribute("id"),a.cursor,a.getInput().value);else{var b=document.createElement("script");b.setAttribute("src","http://suggest.eolin.com/tag/tatter/?id="+a.container.getAttribute("id")+"&cursor="+a.cursor+"&language="+a.language+"&word="+encodeURIComponent(a.getInput().value)+(STD.isSafari?"&encode=1":"")),document.body.appendChild(b)}},Tag.prototype.moveBack=function(){var a=this.getInput().parentNode.previousSibling;if(this.tagList.childNodes.length>1&&a){this.hideSuggestion();var b=a.innerHTML.unhtmlspecialchars();a.parentNode.removeChild(a),this.tagList.lastChild.className="lastChild",this.getInput().value=b}},Tag.prototype.moveUp=function(){this.isSuggestionShown&&(this.cursor++,this.suggestion.selectedIndex--,this.suggestion.selectedIndex<1&&(this.suggestion.selectedIndex=this.suggestion.childNodes.length),this.highlightRow())},Tag.prototype.moveDown=function(){this.isSuggestionShown&&(this.cursor++,this.suggestion.selectedIndex++,this.suggestion.selectedIndex>this.suggestion.childNodes.length&&(this.suggestion.selectedIndex=1),this.highlightRow())},Tag.prototype.highlightRow=function(){if(this.isSuggestionShown&&this.suggestion.childNodes[0].className!="disabled"){for(var a=0;a<this.suggestion.childNodes.length;a++)this.suggestion.childNodes[a].className=a==this.suggestion.selectedIndex-1?"hover":"";this.getInput().value=this.typingText=this.suggestion.childNodes[this.suggestion.selectedIndex-1].innerHTML.replace(new RegExp("</?strong>","gi"),"").unhtmlspecialchars()}},Tag.prototype.getValues=function(){var a=[];for(var b=0;b<this.tagList.childNodes.length-1;b++)a[b]=this.tagList.childNodes[b].innerHTML.trim().unhtmlspecialchars();return a},Tag.prototype.setValue=function(a){if(!this.isSettingValue){this.isSettingValue=!0,this.hideSuggestion();if(this.isTemporaryEditing())this.inputTemporary.parentNode.onclick=this.tagListMouseClick,a.trim()==""?this.inputTemporary.parentNode.parentNode.removeChild(this.inputTemporary.parentNode):this.inputTemporary.parentNode.innerHTML=a,this.typingText="",this.inputTemporary=null;else if(a.trim()!=""){var b=this.tagList.lastChild;b.className="";var c=document.createElement("li");c.onclick=this.tagListMouseClick,c.appendChild(document.createTextNode(a)),this.tagList.removeChild(b),this.tagList.appendChild(c),this.tagList.appendChild(b),this.typingText="",this.inputOnLast.value="",this.focusOnInput()}this.tagList.lastChild.className="lastChild",this.isSettingValue=!1}},Tag.prototype.tagListMouseClick=function(){var a=this.parentNode.instance;a.inputTemporary=a.createSuggestInput(),a.inputTemporary.value=this.innerHTML.unhtmlspecialchars(),a.typingText=this.innerHTML,this.innerHTML="",this.onclick=null,this.appendChild(a.inputTemporary),a.focusOnInput(),a.requestSuggestion()},Tag.prototype.hideSuggestion=function(){this.isSuggestionShown=!1,this.suggestion.style.display="none",this.suggestion.selectedIndex=0},Tag.prototype.focusOnInput=function(){this.getInput().focus(),this.getInput().select()};var StringBuffer=function(){this.buffer=[]};StringBuffer.prototype.append=function(a){this.buffer[this.buffer.length]=a},StringBuffer.prototype.toString=function(){return this.buffer.join("")},String.prototype.trim||(String.prototype.trim=function(){return this.replace(new RegExp("(^\\s*)|(\\s*$)","g"),"")}),String.prototype.htmlspecialchars||(String.prototype.htmlspecialchars=function(){return this.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll("<","&gt;")}),String.prototype.unhtmlspecialchars||(String.prototype.unhtmlspecialchars=function(){return this.replaceAll("&amp;","&").replaceAll("&lt;","<").replaceAll("&gt;",">")});var x=0