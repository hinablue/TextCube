function tcLocationTagFunction_WatchInputBox(id){try{var instance=document.getElementById(id).instance;if(instance.input.value.charAt(instance.input.value.length-1)=='/'){if(input.value.length==1)input.value='';else instance.setValue(instance.input.value,true);return}if(instance.input.value!=instance.typingText){instance.typingText=instance.input.value;instance.requestSuggestion()}}catch(e){}}function tcLocationFunction_showLocalSuggestion(id,cursor,filter){try{var instance=document.getElementById(id).instance}catch(e){return}if(instance.cursor!=cursor||!instance.isTyping)return;var input=instance.input;var xmlhttp=createHttp();if(xmlhttp){xmlhttp.open("GET",blogURL+"/locationSuggest/?id="+id+"&cursor="+cursor+"&filter="+(STD.isSafari?filter:encodeURIComponent(filter)),true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){try{var doc=xmlhttp.responseXML;var root=doc.getElementsByTagName("response")[0];var id=root.getAttribute("id");var cursor=root.getAttribute("cursor");var instance=document.getElementById(id).instance;if(instance.cursor==cursor){var locations=new Array();var locationItems=root.getElementsByTagName("location");if(!instance.allowEolinSuggestion&&locationItems.length==0){instance.hideSuggestion();return}for(var i=0;i<locationItems.length;i++){value=locationItems[i].lastChild.nodeValue.split('/');for(var j=0;j!=-1;j=filter.indexOf('/',j+1)){if(j==0){continue}value.shift()}locations[locations.length]=value.join('/')}for(var i=0;i<locations.length;i++){for(var j=0;j<instance.suggestion.childNodes.length;j++){if(locations[i]==instance.suggestion.childNodes[j].innerHTML.replace(new RegExp("<\/?em>","gi"),"")){instance.suggestion.removeChild(instance.suggestion.childNodes[j]);break}}}var htmlText=new StringBuffer();for(var i=0;i<locations.length;i++){htmlText.append("<li onmouseover=\"this.className='hover'\" onmouseout=\"this.className=''\" onmousedown=\"this.parentNode.instance.suggestionMouseClick(this)\" style=\"background-color: #ccb\"><em>");htmlText.append(locations[i].substring(0,input.value.length).htmlspecialchars().replaceAll("&amp;","&"));htmlText.append("</em>");htmlText.append(locations[i].substring(input.value.length).htmlspecialchars().replaceAll("&amp;","&"));htmlText.append("</li>")}if(instance.allowEolinSuggestion)htmlText.append(instance.suggestion.innerHTML);instance.suggestion.innerHTML=htmlText.toString();if(!instance.allowEolinSuggestion||instance.input.value.trim()==""){instance.suggestion.style.left=getOffsetLeft(input)+"px";instance.suggestion.style.top=getOffsetTop(input)+input.offsetHeight+"px";instance.suggestion.style.display="block";instance.isSuggestionShown=true;try{document.body.removeChild(instance.suggestion)}catch(e){};document.body.appendChild(instance.suggestion)}while(instance.suggestion.childNodes.length>10)instance.suggestion.removeChild(instance.suggestion.childNodes[instance.suggestion.childNodes.length-1])}}catch(e){}}};xmlhttp.send(null);delete xmlhttp}}function tcLocationTagFunction_showSuggestion(){try{var instance=document.getElementById(arguments[0]).instance}catch(e){return}debug("<span style=\"color: red\">Received "+instance.cursor+"</span>");if(instance.cursor!=arguments[1]||!instance.isTyping)return;instance.suggestion.style.left=getOffsetLeft(instance.input)+"px";instance.suggestion.style.top=getOffsetTop(instance.input)+instance.input.offsetHeight+"px";var htmlText=new StringBuffer();if(arguments[2]==0){for(var i=3;i<arguments.length;i++){arguments[i]=arguments[i].replaceAll("&quot;",'"');if(STD.isSafari)arguments[i]=decodeURIComponent(arguments[i]);htmlText.append("<li onmouseover=\"this.className='hover'\" onmouseout=\"this.className=''\" onmousedown=\"this.parentNode.instance.suggestionMouseClick(this)\">");htmlText.append(arguments[i].replace(new RegExp("("+instance.input.value+")","gi"),"<em>$1</em>"));htmlText.append("</li>")}}else{var message1=arguments[3];var message2=arguments[4];var message3=arguments[5];if(STD.isSafari){message1=decodeURIComponent(message1);message2=decodeURIComponent(message2);message3=decodeURIComponent(message3)}if(instance.locationList.childNodes.length==1)htmlText.append("<li class=\"disabled\"><em>"+instance.input.value+"</em> - "+message1+"<br />"+message2+"</li>");else if(instance.input.value.trim()=="")htmlText.append("<li class=\"disabled\">"+message3+"</li>");else htmlText.append("<li class=\"disabled\"><em>"+instance.input.value+"</em> - "+message1+"</li>")}instance.suggestion.innerHTML=htmlText.toString();instance.suggestion.style.display="block";instance.isSuggestionShown=true;try{document.body.removeChild(instance.suggestion)}catch(e){};document.body.appendChild(instance.suggestion)}function LocationTag(container,language,disable){this.name="Eolin Location Tag Object";this.copyright="Tatter & Company";this.allowEolinSuggestion=(typeof(disable)=="undefined")?false:!disable;this.isFocused=false;this.isSettingValue=false;this.instance=this;this.cursor=0;this.inputClassName="";this.language="ko";if(typeof language!="undefined")this.language=language;this.isTyping=false;this.isSuggestionShown=false;this.typingText="";this.container=container;this.container.instance=this;this.suggestion=document.createElement("ul");this.suggestion.instance=this;this.suggestion.selectedIndex=0;this.suggestion.className="tcSuggest";this.suggestion.style.margin="0px";this.suggestion.style.padding="0px";this.suggestion.style.listStyleType="none";this.suggestion.style.position="absolute";this.suggestion.style.display="none";this.suggestion.style.zIndex="999";this.input=document.createElement("input");this.input.instance=this;this.input.className=this.inputClassName;this.input.setAttribute("autocomplete","off");this.input.onblur=function(){this.instance.isTyping=false;this.instance.typingText="";this.instance.setValue(this.value);this.instance.isFocused=false};this.input.onfocus=function(){if(this.instance.isFocused)return;else this.instance.isFocused=true;this.instance.isTyping=true;this.instance.typingText=this.value;this.instance.requestSuggestion()};this.input.onkeydown=function(event){var instance=this.instance;instance.isTyping=true;event=instance.adjustEventCompatibility(event);switch(event.keyCode){case 8:if(this.value=="")instance.moveBack();else return event.keyCode;break;case 13:instance.setValue(this.value,true);break;case 191:if(!event.shiftKey)instance.setValue(this.value,true);else return event.keyCode;break;case 9:if(this.value.trim()=="")return event.keyCode;instance.setValue(this.value,true);break;case 27:instance.hideSuggestion();break;case 38:instance.moveUp();break;case 40:instance.moveDown();break;default:return event.keyCode}event.returnValue=false;event.cancelBubble=true;try{event.preventDefault()}catch(e){}return false};this.input.onkeypress=function(event){return preventEnter(event)};this.input.onkeyup=function(event){var instance=this.instance;instance.isTyping=true;event=instance.adjustEventCompatibility(event);switch(event.keyCode){case 191:instance.setValue(this.value,true);break;default:return event.keyCode}event.returnValue=false;event.cancelBubble=true;try{event.preventDefault()}catch(e){}return false};setInterval("tcLocationTagFunction_WatchInputBox('"+this.container.id+"')",10);this.locationList=document.createElement("ul");this.locationList.instance=this;var listItem=document.createElement("li");listItem.className="lastChild";listItem.appendChild(this.input);this.locationList.appendChild(listItem);this.container.appendChild(this.locationList)}LocationTag.prototype.getValues=function(){var locations=new Array();for(var i=0;i<this.locationList.childNodes.length-1;i++)locations[i]=this.locationList.childNodes[i].innerHTML.trim().unhtmlspecialchars();return"/"+locations.join("/")};LocationTag.prototype.setValue=function(str,focusOnInput){if(this.isSettingValue)return;else this.isSettingValue=true;this.hideSuggestion();var locations=this.stringToLocation(str);var input=this.input;this.input.parentNode.parentNode.removeChild(this.input.parentNode);for(var i=0;i<locations.length;i++){var listItem=document.createElement("li");listItem.onclick=this.locationListMouseClick;listItem.appendChild(document.createTextNode(locations[i]));this.locationList.appendChild(listItem)}var listItem=document.createElement("li");listItem.appendChild(this.input);this.locationList.appendChild(listItem);this.locationList.lastChild.className="lastChild";this.input.value="";this.typingText="";if(focusOnInput){this.focusOnInput();if(navigator.userAgent.indexOf("Gecko")!=-1)this.requestSuggestion()}this.isSettingValue=false};LocationTag.prototype.focusOnInput=function(){this.input.focus();this.input.select();try{setTimeout("document.getElementById('"+this.container.id+"').instance.input.focus()",1)}catch(e){}};LocationTag.prototype.setInputClassName=function(str){this.inputClassName=str;this.input.className=str};LocationTag.prototype.suggestionMouseClick=function(obj){this.setValue(obj.innerHTML.replace(new RegExp("<\/?em>","gi"),"").replaceAll("&amp;","&"),true);this.hideSuggestion()};LocationTag.prototype.locationListMouseClick=function(event){var instance=this.parentNode.instance;var input=instance.input;input.value=this.innerHTML.unhtmlspecialchars();while(this.nextSibling)this.parentNode.removeChild(this.nextSibling);this.typingText="";this.innerHTML="";this.onclick=null;this.appendChild(input);instance.focusOnInput()};LocationTag.prototype.hideSuggestion=function(){this.isSuggestionShown=false;this.suggestion.style.display="none";this.suggestion.selectedIndex=0};LocationTag.prototype.moveUp=function(){if(this.isSuggestionShown){this.cursor++;this.suggestion.selectedIndex--;if(this.suggestion.selectedIndex<1)this.suggestion.selectedIndex=this.suggestion.childNodes.length;this.highlightRow()}};LocationTag.prototype.moveBack=function(){var prevNode=this.input.parentNode.previousSibling;if(this.locationList.childNodes.length>1&&prevNode){this.hideSuggestion();var text=prevNode.innerHTML.unhtmlspecialchars();prevNode.parentNode.removeChild(prevNode);this.locationList.lastChild.className="lastChild";this.input.value=text}};LocationTag.prototype.moveDown=function(){if(this.isSuggestionShown){this.cursor++;this.suggestion.selectedIndex++;if(this.suggestion.selectedIndex>this.suggestion.childNodes.length)this.suggestion.selectedIndex=1;this.highlightRow()}};LocationTag.prototype.highlightRow=function(){if(this.isSuggestionShown&&this.suggestion.childNodes[0].className!="disabled"){for(var i=0;i<this.suggestion.childNodes.length;i++)this.suggestion.childNodes[i].className=(i==this.suggestion.selectedIndex-1)?"hover":"";this.input.value=this.typingText=this.suggestion.childNodes[this.suggestion.selectedIndex-1].innerHTML.replace(new RegExp("<\/?em>","gi"),"").unhtmlspecialchars()}};LocationTag.prototype.getPath=function(){var path=this.getValues();return path+((path=="/")?"":"/")+this.input.value};LocationTag.prototype.requestSuggestion=function(){var instance=this.instance;if(!instance.allowEolinSuggestion||(instance.input.value.trim()=="")){tcLocationFunction_showLocalSuggestion(instance.container.getAttribute("id"),instance.cursor,this.getPath());return}instance.isTyping=true;instance.cursor++;debug("Request "+instance.cursor);var script=document.createElement("script");script.setAttribute("src","http://suggest.tc.com/location/script/?id="+instance.container.getAttribute("id")+"&cursor="+instance.cursor+"&language="+instance.language+"&path="+encodeURIComponent(instance.getPath())+(STD.isSafari?"&encode=1":""));document.body.appendChild(script)};LocationTag.prototype.stringToLocation=function(str){try{var ret=new Array();var locations=str.split("/");for(var i=0;i<locations.length;i++){if(locations[i].trim()!="")ret[ret.length]=locations[i].trim()}return ret}catch(e){return new Array()}};LocationTag.prototype.adjustEventCompatibility=function(event){if(navigator.appName=="Microsoft Internet Explorer"){event=window.event;event.target=event.srcElement}return event};function getOffsetTop(obj){return obj?obj.offsetTop+getOffsetTop(obj.offsetParent):0}function getOffsetLeft(obj){return obj?obj.offsetLeft+getOffsetLeft(obj.offsetParent):0}var StringBuffer=function(){this.buffer=new Array()};StringBuffer.prototype.append=function(str){this.buffer[this.buffer.length]=str};StringBuffer.prototype.toString=function(){return this.buffer.join("")};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(new RegExp("(^\\s*)|(\\s*$)","g"),"")}}if(!String.prototype.htmlspecialchars){String.prototype.htmlspecialchars=function(){return this.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll("<","&gt;")}}if(!String.prototype.unhtmlspecialchars){String.prototype.unhtmlspecialchars=function(){return this.replaceAll("&amp;","&").replaceAll("&lt;","<").replaceAll("&gt;",">")}}var x=0;function debug(s){try{document.getElementById("debug").innerHTML=++x+")"+s+"<br />"+document.getElementById("debug").innerHTML}catch(e){}}